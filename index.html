<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Employ yourself</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'>

  <!--script src="http://code.jquery.com/jquery-1.9.1.js"></script-->
  <!--script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script-->
  <!--script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script-->

  <link href="style.css" rel="stylesheet">

</head>
<body>
    
   <!nav role="navigation">
    <table class="navtop">
        <tr>
            <th><a href="#1">Welcome</a></th>
            <th><a href="#2">Map</a></th>
            <th><a href="#3">Properties</a></th>
            <th><a href="#4">Business</a></th>
        </tr>
    </table>
    <!/nav>
    
    <!--заглавная картинка с приветственным словом-->
    <div class="promo" >
        <div class="center"><h1>Worker enterprise</h1>
            <h2>Choose better place for your next workplace</h2>
        </div>
    </div>

    <nav role="navigation">
    <table class="nav">
        <tr>
            <th><a href="#1">Welcome</a></th>
            <th><a href="#2">MAP</a></th>
            <th><a href="#3">Properties</a></th>
            <th><a href="#4">Business</a></th>
        </tr>
    </table>
    </nav>

    <!--карта с отображением свойств микрорайона-->
    <div class="undermap">
        <div class="half60">
            <div id="map"></div>
        </div>
        <div class="half40" id="description">
            <p>Сюда пишутся данные из json</p>
            <p>Население, чел: </p>
            <meter value="1300" optimum="3000" low="2000" high="5000" min="550" max="7900"></meter>
            <p>Муниципальная/Жилая: </p>
            <p>Наличие бизнес-объектов, шт: </p>
            <meter value="1" optimum="3" low="1" high="8" min="0" max="10"></meter>
            <p>Удаление от главных улиц, м: </p>
            <meter value="40" optimum="40" low="0" high="100" min="0" max="200"></meter>
        </div>
    </div>
    
    <nav role="navigation">
    <table class="nav">
        <tr>
            <th><a href="#1">Welcome</a></th>
            <th><a href="#2">MAP</a></th>
            <th><a name="3">Properties</a></th>
            <th><a href="#4">Business</a></th>
        </tr>
    </table>
    </nav>

    <!--микрорайон с возможностью развития-->
    <div class="undermap">
        <div id="blocktype" class="half60" >
            <img src="pic/1.png"  height="100%" >
        </div>
        
        <div id="params" class="half40">
            <ul>
		<li onclick="showTable(1);">Cheese</li>
		<li onclick="showTable(2);">Beer</li>
		<li onclick="showTable(3);">Wood</li>
	    </ul>
	    
            <p id="wrkrs">Employers: 1</p>
	    <input type="range" min="1" max="10" name="workers" value="1" width="80%" 
		oninput="changeWorkers(this.value)">
            <p id="bldsz">Building size: small</p>
            <!--input type="range" min="1" max="3" name="buildsize" value="1" 
		onchange="document.getElementById('bldsz').innerText = 'Building size: '+ bldsz[this.value-1];"-->
            <input type="range" min="1" max="3" name="buildsize" value="1" 
		oninput="changeBuildingSize(this.value);">
            <p><button>Поехали...</button></p>
        </div>
       
    </div>

    <nav role="navigation">
    <table class="nav">
        <tr>
            <th><a href="#1">Welcome</a></th>
            <th><a href="#2">MAP</a></th>
            <th><a href="#3">Properties</a></th>
            <th><a name="4">Business</a></th>
        </tr>
    </table>
    </nav>

    <!--итоговое резюме проекта-->
    <!--div class="promo" >
        <div class="center"><h1> That's all, Folks</h1>
        </div>
    </div-->
    
    <!--div class="undermap"-->
        <table class="finance" id="cheese" border="1">
            <tr>
                <th ></th>
                <th >Capex, &#x20bd;</th>
                <th ></th>
                <th ></th>
                <th >Opex, &#x20bd;</th>
                <th ></th>
                <th ></th>
                <th >Revenue, &#x20bd;</th>
                <th ></th>
            </tr>
            <tr>
                <th >Title</th>
                <th >Units</th>
                <th >Total, &#x20bd;</th>
                <th >Title</th>
                <th >Units</th>
                <th >Total, &#x20bd;</th>
                <th >Title</th>
                <th >Units</th>
                <th >Total, &#x20bd;</th>
            </tr>


            <tr>
                <td>Building, units</td><td>3</td><td>300000</td><td>Wage fund</td><td>5</td><td>250000</td><td>Cheese</td><td>250</td><td>300000</td>
            </tr>
            <tr>
                <td>производственное оборудование</td><td>1</td><td>2001000</td><td>Consumables</td><td>5</td><td>450</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>торговое оборудование, units</td><td>1</td><td>2003000</td><td>land rental</td><td>1</td><td>100</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>подключение к сетям</td><td>1</td><td>2000400</td><td>коммуналка</td><td>1</td><td>100</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>гос оформление</td><td>1</td><td>2000500</td><td>ремонт</td><td>1</td><td>100</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>первоначальные расходы</td><td>1</td><td>2000500</td><td>патент</td><td>1</td><td>100</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <th>Total</th><th ></th><th ></th><th ></th><th ></th><th ></th><th ></th><th ></th><th ></th>
            </tr>
            <tr>
                <td>Capex</td><td></td><td>200000</td><td>Opex</td><td></td><td>100</td><td>revenue</td><td></td><td>100</td>
            </tr>
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>период окупаемости</td><td></td><td>20</td><td>Выручка</td><td></td><td>30000</td><td></td><td></td><td></td>
            </tr>
        </table>
    
    
    <table class="finance" id="saw" border="1">
            <tr>
                <th ></th>
                <th >Capex, &#x20bd;</th>
                <th ></th>
                <th ></th>
                <th >Opex, &#x20bd;</th>
                <th ></th>
                <th ></th>
                <th >Revenue, &#x20bd;</th>
                <th ></th>
            </tr>
            <tr>
                <th >Title</th>
                <th >Units</th>
                <th >Sum, &#x20bd;</th>
                <th >Title</th>
                <th >Units</th>
                <th >Sum, &#x20bd;</th>
                <th >Title</th>
                <th >Units</th>
                <th >Sum, &#x20bd;</th>
            </tr>


            <tr>
                <td>Building, units</td><td>3</td><td>300000</td><td>Wage fund</td><td>5</td><td>250000</td><td>Furniture</td><td>0</td><td>0</td>
            </tr>
            <tr>
                <td>производственное оборудование</td><td>1</td><td>2001000</td><td>Consumables</td><td>0</td><td>450</td><td>Master Classes</td><td>0</td><td>0</td>
            </tr>
            <tr>
                <td>торговое оборудование, units</td><td>1</td><td>2003000</td><td>land rental</td><td>1</td><td>100</td><td>Equipment rental</td><td>0</td><td>0</td>
            </tr>
            <tr>
                <td>подключение к сетям</td><td>1</td><td>2000400</td><td>коммуналка</td><td>1</td><td>100</td><td>Repair</td><td>0</td><td>0</td>
            </tr>
            <tr>
                <td>гос оформление</td><td>1</td><td>2000500</td><td>ремонт</td><td>1</td><td>100</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>первоначальные расходы</td><td>1</td><td>2000500</td><td>патент</td><td>1</td><td>100</td><td></td><td></td><td></td>
            </tr>
            <tr>
                <th>Sum</th><th ></th><th ></th><th ></th><th ></th><th ></th><th ></th><th ></th><th ></th>
            </tr>
            <tr>
                <td>Capex</td><td></td><td>200000</td><td>Opex</td><td></td><td>100</td><td>revenue</td><td></td><td>100</td>
            </tr>
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
                <td>период окупаемости</td><td></td><td>20</td><td>Выручка</td><td></td><td>30000</td><td></td><td></td><td></td>
            </tr>
        </table>
 
        <table class="business" id="business">
           
            <tr>
                <th>Key parthership</th><th>Key activities</th><th>Key resources</th><th>Value proposition</th><th>Customer relationship</th>
            </tr>
            <tr>
                <td>Key parthership</td><td>Key activities</td><td>Key resources</td><td>Value proposition</td><td>Customer relationship</td>
            </tr>
            <tr>
                <th>Customer segments</th><th>Cost structure</th><th colspan="2">Revenue streams</th><th>Channels</th>
            </tr>
            <tr>
                <td>Customer segments</td><td>Cost structure</td><td colspan="2">Revenue streams</td><td>Channels</td>
            </tr>
                 
        </table>
     <!--/div-->        
   

<script src="const.js"></script>

<script>
   mapboxgl.accessToken = 'pk.eyJ1IjoibWlraGFpbHNva29sb3YiLCJhIjoiY2pldjZ0NHZqMGI5MTJxbDd1dHV3ZDl0eiJ9.omvRoGjfSasjuCVj9TRJRw';

const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mikhailsokolov/cjv184fxl4ajt1fovcrnvofxj',
  center: [37.759454, 55.823340],
  zoom: 14.6
});
    
  
    
map.on('load', function () {
    map.addSource('cells', {
        type: 'vector',
        url: 'mapbox://mikhailsokolov.1032comy'
    });
map.addLayer({
    'id': 'newlayer',
    'source': 'cells',
    'type': 'fill',
    'paint':{'fill-color': '#f29035',
            'fill-opacity': 0.4},
    'source-layer':'cells43-c28lyf'
    });
});
      
map.on('mouseenter', 'newlayer', function () {
    map.getCanvas().style.cursor = 'pointer';
});
 

map.on('mouseleave', 'newlayer', function () {
    map.getCanvas().style.cursor = '';
});
    
map.on('click', 'newlayer', function (e) {

    blocktype = e.features[0].properties.blocktype;
    ismunicipal = e.features[0].properties.ismunicipal;
    population = e.features[0].properties.population;
    business = e.features[0].properties.amount || 0;
    distance = e.features[0].properties.width || 100000;
    // count with remap
    //low2+(X-low1)*(high2-low2)/(high1-low1)
    activity = 1+(e.features[0].properties.activity-1)*(2-1)/(10-1);
    demand = population * 0.25 * (10-business)/10;
    
    //console.log(demand);

    document.getElementById('description').innerHTML = 
        '<p>Население, чел: ' + population + '</p>' +
        '<meter value=' + population + ' optimum="3000" low="2500" high="4500" min="0" max="5000"></meter>' +
        '<p>Муниципальная/Жилая: ' + (e.features[0].properties.ismunicipal ? "Муниципальная" : "Жилая") + "</p>" +
        '<p>Наличие бизнес-объектов, шт: ' + business + '</p>' +
        '<meter value=' + business + ' optimum="3" low="1" high="8" min="0" max="10"></meter>' +
        '<p>Удаление от главных улиц, м: ' + distance + '</p>' +
        '<meter value=' + distance + ' optimum="40" low="0" high="100" min="0" max="200"></meter>';
    
    //console.log(activity);
    
    document.getElementById('blocktype').innerHTML =
        '<img src="pic/' + blocktype + '.png"  height="100%">';
    
}); 

var cheese_table = document.getElementById("cheese").rows;
var saw_table = document.getElementById("saw").rows
    

function showTable(tbl) {
    switch (tbl) {
	case 1 :
		document.getElementById("cheese").style.display = "";
        document.getElementById("saw").style.display = "none"
		break;	
	case 2 :
		document.getElementById("cheese").style.display = "none"
        document.getElementById("saw").style.display = "none";
		break;	
	case 3 :
		document.getElementById("cheese").style.display = "none"
        document.getElementById("saw").style.display = "";
		break;	
    }
}
var bld_slider = document.getElementsByName("buildsize")[0];	// слайдер Размер здания
var wrk_slider = document.getElementsByName("workers")[0];	// слайдер Работники

function changeWorkers(p_value) {

    document.getElementById('wrkrs').innerText = 'Workers: '+ p_value;

    switch (p_value) {
	case '1' :
	case '2' :
	case '3' :
		bld_slider.value = '1';	// размер здания от работников
		break;
	case '4' :
	case '5' :
	case '6' :
		bld_slider.value = '2';
		break;
	case '7' :
	case '8' :
	case '9' :
	case '10' :
		bld_slider.value = '3';
		break;
    }
    
    document.getElementById('bldsz').innerText = 'Building size: '+ bldsz[bld_slider.value-1];
    
    calcFinTable(p_value, bld_slider.value);
}

function changeBuildingSize (p_value) {
    document.getElementById('bldsz').innerText = 'Building size: '+ bldsz[p_value-1];
    
    switch (p_value) {
	case '1' :
		wrk_slider.value = '2';	// кол-во работников от размера здания
		break;
	case '2' :
		wrk_slider.value = '5';
		break;
	case '3' :
		wrk_slider.value = '8';
		break;
    }
    
    document.getElementById('wrkrs').innerText = 'Workers: '+ wrk_slider.value;
    
    calcFinTable(wrk_slider.value, p_value);
}


// расчет фин таблицы
function calcFinTable(p_workers,p_buildsize) {

//CHEESE CALC - START ------------------------------------------------------------------------------------    
    
    //wage fund(2;5), (2;4)
    cheese_table[2].cells[5].innerText = p_workers * 30000;
    cheese_table[2].cells[4].innerText = p_workers;
    
    
    //consumables (3,4), (3,5)
    cheese_table[3].cells[4].innerText = p_workers * 10;
    if(p_workers*220 < Number(demand).toFixed(0) *0.25)
    {
        cheese_table[3].cells[5].innerText = p_workers * 220 * 450;
    }else{cheese_table[3].cells[5].innerText = Number(demand).toFixed(0) * 450 *0.25;};
    
    //коммуналка
    cheese_table[5].cells[4].innerText = p_workers * 10 * 22;
    cheese_table[5].cells[5].innerText = p_workers * 10 * 22 * 16;
    
    //патент 
     cheese_table[7].cells[4].innerText = 1;
    cheese_table[7].cells[5].innerText = 5000;
    
    //первоначальные расходы
    cheese_table[7].cells[2].innerText = 3 * cheese_table[9].cells[5].textContent;
    
   
    
    //производится:
    cheese_table[3].cells[6].innerText = "производится";
    cheese_table[3].cells[7].innerText = p_workers*10*22;
    cheese_table[3].cells[8].innerText = p_workers*10*22*1500;
    cheese_table[2].cells[7].innerText = Number(demand).toFixed(0)*0.25;
    cheese_table[2].cells[8].innerText = Number(demand * 0.25*1500).toFixed(0);
    
    if (parseInt(cheese_table[2].cells[8].textContent) < parseInt(cheese_table[3].cells[8].textContent)) {
        cheese_table[9].cells[8].innerText = parseInt(cheese_table[2].cells[8].textContent);
    } 
    else { 
	cheese_table[9].cells[8].innerText = parseInt(cheese_table[3].cells[8].textContent); 
    };
    
   

    //building
    cheese_table[2].cells[2].innerText = buildCost[0] * p_buildsize ;
    
    cheese_table[2].cells[1].innerText = p_buildsize;
    //производ оборуд
    cheese_table[3].cells[1].innerText = p_buildsize;
    cheese_table[3].cells[2].innerText = p_buildsize * 200000;
    //торг оборуд
    cheese_table[4].cells[1].innerText = 1;
    cheese_table[4].cells[2].innerText = 200000;
    
    //гос комиссия
    cheese_table[6].cells[1].innerText = 1;
    cheese_table[6].cells[2].innerText = 20000;
    
    //первоначальные расходы
    
    cheese_table[7].cells[1].innerText = 3;
    
    //land rental
    cheese_table[4].cells[5].innerText = Number(bldKoef[p_buildsize-1] * 16000 * activity).toFixed(0);;
    cheese_table[4].cells[4].innerText = bldKoef[p_buildsize-1];
    
        //repair
     cheese_table[6].cells[4].innerText = buildingsize[p_buildsize-1];
    cheese_table[6].cells[5].innerText = buildingsize[p_buildsize-1] * 25;
    //подключение к сетям
    cheese_table[5].cells[1].innerText = 1;
    cheese_table[5].cells[2].innerText = 50000;
    
     //sum_capex
    cheese_table[9].cells[2].innerText = parseInt(cheese_table[2].cells[2].textContent) +
				      parseInt(cheese_table[3].cells[2].textContent) +
				      parseInt(cheese_table[4].cells[2].textContent) +
				      parseInt(cheese_table[5].cells[2].textContent) +
				      parseInt(cheese_table[6].cells[2].textContent) +
				      parseInt(cheese_table[7].cells[2].textContent);

    
    //sum_opex
    cheese_table[9].cells[5].innerText = parseInt(cheese_table[2].cells[5].textContent) +
				      parseInt(cheese_table[3].cells[5].textContent) +
				      parseInt(cheese_table[4].cells[5].textContent) +
				      parseInt(cheese_table[5].cells[5].textContent) +
				      parseInt(cheese_table[6].cells[5].textContent) +
				      parseInt(cheese_table[7].cells[5].textContent);
     //выручка
   cheese_table[11].cells[5].innerText = parseInt(cheese_table[9].cells[8].textContent) -
				      parseInt(cheese_table[9].cells[5].textContent)
        
    
    //окупаемость
    cheese_table[11].cells[2].innerText = parseInt(cheese_table[9].cells[2].textContent) /
				       parseInt(cheese_table[11].cells[5].textContent)

    
    
//CHEESE CALC END -----------------------------------------------------------
    
//SAW CALC START ------------------------------------------------------------
    
    //building
    saw_table[2].cells[2].innerText = buildCost[0] * p_buildsize ;
    
    saw_table[2].cells[1].innerText = p_buildsize;
    //производ оборуд
    saw_table[3].cells[1].innerText = p_buildsize;
    saw_table[3].cells[2].innerText = p_buildsize * 200000;
    //торг оборуд
    saw_table[4].cells[1].innerText = 1;
    saw_table[4].cells[2].innerText = 200000;
    
    //гос комиссия
    saw_table[6].cells[1].innerText = 1;
    saw_table[6].cells[2].innerText = 20000;
    
    //первоначальные расходы
    
    saw_table[7].cells[1].innerText = 3;
    
    //land rental
    saw_table[4].cells[5].innerText = Number(bldKoef[p_buildsize-1] * 16000 * activity).toFixed(0);;
    saw_table[4].cells[4].innerText = bldKoef[p_buildsize-1];
    
        //repair
     saw_table[6].cells[4].innerText = buildingsize[p_buildsize-1];
    saw_table[6].cells[5].innerText = buildingsize[p_buildsize-1] * 25;
    //подключение к сетям
    saw_table[5].cells[1].innerText = 1;
    saw_table[5].cells[2].innerText = 50000;
    //sum_capex
     saw_table[9].cells[2].innerText = parseInt(saw_table[2].cells[2].textContent) + parseInt(saw_table[3].cells[2].textContent)
        + parseInt(saw_table[4].cells[2].textContent) 
        + parseInt(saw_table[5].cells[2].textContent) 
        + parseInt(saw_table[6].cells[2].textContent) 
        + parseInt(saw_table[7].cells[2].textContent);
    
        saw_table[2].cells[5].innerText = p_workers * 30000;
    saw_table[2].cells[4].innerText = p_workers;
    
    
    //consumables (3,4), (3,5)
    saw_table[3].cells[4].innerText = p_workers * 10;
    saw_table[3].cells[5].innerText = p_workers * 4 * 4200;
    
    //коммуналка
    saw_table[5].cells[4].innerText = p_workers * 10 * 22;
    saw_table[5].cells[5].innerText = p_workers * 10 * 22 * 16;
    
    //патент 
     saw_table[7].cells[4].innerText = 1;
    saw_table[7].cells[5].innerText = 5000;
    
    //первоначальные расходы
    saw_table[7].cells[2].innerText = 3 * saw_table[9].cells[5].textContent;
    
    
    
    //производится:
    
    saw_table[2].cells[7].innerText = p_workers*4;
    saw_table[2].cells[8].innerText = p_workers*4*25000;
    saw_table[3].cells[7].innerText = p_workers*4;
    saw_table[3].cells[8].innerText = 30000;
    saw_table[4].cells[7].innerText = 4;
    saw_table[4].cells[8].innerText = 15000;
    saw_table[5].cells[7].innerText = 300;
    saw_table[5].cells[8].innerText = 15000;
    
    //sum_capex
    saw_table[9].cells[2].innerText = parseInt(saw_table[2].cells[2].textContent) + parseInt(saw_table[3].cells[2].textContent)
    + parseInt(saw_table[4].cells[2].textContent) 
        + parseInt(saw_table[5].cells[2].textContent) 
        + parseInt(saw_table[6].cells[2].textContent) 
        + parseInt(saw_table[7].cells[2].textContent);

   
    
    //sum_opex
    saw_table[9].cells[5].innerText = parseInt(saw_table[2].cells[5].textContent) + parseInt(saw_table[3].cells[5].textContent)
    + parseInt(saw_table[4].cells[5].textContent) 
        + parseInt(saw_table[5].cells[5].textContent) 
        + parseInt(saw_table[6].cells[5].textContent) 
        + parseInt(saw_table[7].cells[5].textContent);
    
      //sum_revenue
    saw_table[9].cells[8].innerText = parseInt(saw_table[2].cells[8].textContent) + parseInt(saw_table[3].cells[8].textContent)
    + parseInt(saw_table[4].cells[8].textContent) 
        + parseInt(saw_table[5].cells[8].textContent);
    
   // if (parseInt(table_fin[2].cells[8].textContent) < parseInt(fin_table[3].cells[8].textContent)) {
//        fin_table[9].cells[8].innerText = parseInt(fin_table[2].cells[8].textContent);
 //   } else { fin_table[9].cells[8].innerText = parseInt(fin_table[3].cells[8].textContent); };
    
    //выручка
   saw_table[11].cells[5].innerText = parseInt(saw_table[9].cells[8].textContent) - parseInt(saw_table[9].cells[5].textContent);
        
    
    //окупаемость
    saw_table[11].cells[2].innerText = parseInt(saw_table[9].cells[2].textContent) / parseInt(saw_table[11].cells[5].textContent);
    
    
    

}


</script>
    
</body>
</html>
